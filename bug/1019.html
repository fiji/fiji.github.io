<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 1019 &ndash; Align image by Line ROI results in Java error</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_Fiji bz_component_Plugins bz_bug_1019 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1019</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Align image by Line ROI results in Java error</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2015-03-26 04:51:41 CDT</p>
    </td>
</tr>
</table>


</div> 

<div id="bugzilla-body">


<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2015-03-26 04:51:41">
  <input type="hidden" name="longdesclength" value="4">
  <input type="hidden" name="id" value="1019">
  <input type="hidden" name="token" value="1492731887-IgllHoESw3yT78v68u-biA-4MggUMqpP35u6vNzBGlo">
<div class="bz_alias_short_desc_container edit_form">
     <a href="1019.html"><b>Bug&nbsp;1019</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Align image by Line ROI results in Java error</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td>Align image by Line ROI results in Java error
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Plugins</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P4
       normal
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">ImageJ Bugs Mailing List</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2015-03-04 10:06 CST by <span class="vcard">amc910
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2015-03-26 04:51 CDT 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>2 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="amc910">amc910</option>
                <option value="ctrueden">ctrueden</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    



  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">amc910
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-03-04 10:06:17 CST
        </span>
      </div>



<pre class="bz_comment_text" >Hi there,

I'm trying to run the 'Align image by line ROI' utility, and I keep getting a Java error.

The following macro results in the same error:
-----------------
run(&quot;Dot Blot (7K)&quot;);
run(&quot;Dot Blot (7K)&quot;);

selectWindow(&quot;Dot_Blot.jpg&quot;);
makeLine(116, 256, 475, 97);
selectWindow(&quot;Dot_Blot-1.jpg&quot;);
makeLine(106, 111, 404, 172);

run(&quot;Align Image by line ROI&quot;);
-----------------

Hit 'OK' and the following Java error is printed:

-----------------
(Fiji Is Just) ImageJ 2.0.0-rc-25/1.49p; Java 1.6.0_24 [64-bit]; Windows 7 6.1; 100MB of 5971MB (1%)
 
java.lang.NullPointerException
	at Align_Image.align(Align_Image.java:139)
	at Align_Image.run(Align_Image.java:83)
	at ij.IJ.runUserPlugIn(IJ.java:199)
	at ij.IJ.runPlugIn(IJ.java:163)
	at ij.Executer.runCommand(Executer.java:131)
	at ij.Executer.run(Executer.java:64)
	at ij.IJ.run(IJ.java:275)
	at ij.IJ.run(IJ.java:250)
	at ij.macro.Functions.doRun(Functions.java:593)
	at ij.macro.Functions.doFunction(Functions.java:89)
	at ij.macro.Interpreter.doStatement(Interpreter.java:226)
	at ij.macro.Interpreter.doStatements(Interpreter.java:214)
	at ij.macro.Interpreter.run(Interpreter.java:111)
	at ij.macro.Interpreter.run(Interpreter.java:81)
	at ij.macro.Interpreter.run(Interpreter.java:92)
	at ij.plugin.Macro_Runner.runMacro(Macro_Runner.java:153)
	at ij.IJ.runMacro(IJ.java:116)
	at ij.IJ.runMacro(IJ.java:105)
	at net.imagej.legacy.IJ1Helper.runMacro(IJ1Helper.java:794)
	at net.imagej.legacy.plugin.IJ1MacroEngine.eval(IJ1MacroEngine.java:116)
	at net.imagej.legacy.plugin.IJ1MacroEngine.eval(IJ1MacroEngine.java:160)
	at org.scijava.script.ScriptModule.run(ScriptModule.java:175)
	at org.scijava.module.ModuleRunner.run(ModuleRunner.java:167)
	at org.scijava.module.ModuleRunner.call(ModuleRunner.java:126)
	at org.scijava.module.ModuleRunner.call(ModuleRunner.java:65)
	at org.scijava.thread.DefaultThreadService$2.call(DefaultThreadService.java:164)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
-------------

From the first two lines in the error log I'm assuming it has to do with lines 139 and 83 in Align_image.java:
131:    float dx1 = line1.x2 - line1.x1;
83:    ImageProcessor result = align(source.getProcessor(), line1, target.getProcessor(), line2, withScaling, withRotation);

From: <a href="https://github.com/fiji/VIB/blob/master/src/main/java/Align_Image.java">https://github.com/fiji/VIB/blob/master/src/main/java/Align_Image.java</a>

I'm afraid I'm not really sure where to go from here, any ideas?

Information about your version of Java:

  os.arch =&gt; amd64
  os.name =&gt; Windows 7
  os.version =&gt; 6.1
  java.version =&gt; 1.6.0_24
  java.vendor =&gt; Sun Microsystems Inc.
  java.runtime.name =&gt; Java(TM) SE Runtime Environment
  java.runtime.version =&gt; 1.6.0_24-b07
  java.vm.name =&gt; Java HotSpot(TM) 64-Bit Server VM
  java.vm.version =&gt; 19.1-b02
  java.vm.vendor =&gt; Sun Microsystems Inc.
  java.vm.info =&gt; mixed mode
  java.awt.graphicsenv =&gt; sun.awt.Win32GraphicsEnvironment
  java.specification.name =&gt; Java Platform API Specification
  java.specification.version =&gt; 1.6
  sun.cpu.endian =&gt; little
  sun.desktop =&gt; windows
  file.separator =&gt; \

The up-to-date check says: REMIND_LATER

Information relevant to JAVA_HOME related problems:

  JAVA_HOME is set to: C:\Work\FIJI-W~1\Fiji.app/java/win64/jdk1.6.0_24//jre
  imagej.dir =&gt; C:\Work\FIJI-W~1\Fiji.app

Information about the version of each plugin:

Activated update sites:
ImageJ: <a href="http://update.imagej.net/">http://update.imagej.net/</a> (last check:20150302042523)
Fiji: <a href="http://fiji.sc/update/">http://fiji.sc/update/</a> (last check:20150302225742)

Files not up-to-date:
  b0038cbf (MODIFIED) 20150304154358 jars/ij-1.49m.jar
  1ad3be0d (LOCAL_ONLY) 20140201185146 jars/jpedalSTD.jar
  c7660983 (LOCAL_ONLY) 20140731142918 macros/Angus1.ijm
  c55dde81 (LOCAL_ONLY) 20140731142926 macros/Angus2.ijm
  0be8846e (LOCAL_ONLY) 20141210131404 macros/BatchScale.ijm
  0a23f9af (LOCAL_ONLY) 20140729120848 macros/Bleach Correction.ijm
  d71b3fa8 (LOCAL_ONLY) 20150217134500 macros/Confocal1.ijm
  9078abc5 (LOCAL_ONLY) 20150120131532 macros/Cropping.ijm
  6eeac28f (LOCAL_ONLY) 20141204141336 macros/DateLastModified.ijm
  19ddd309 (LOCAL_ONLY) 20140626124302 macros/FullScan_100x.ijm
  35e3bd87 (LOCAL_ONLY) 20140626124325 macros/FullScan_200x.ijm
  6727eb24 (LOCAL_ONLY) 20140626124218 macros/FullScan_25x.ijm
  470b2083 (LOCAL_ONLY) 20140626124344 macros/FullScan_500x.ijm
  23e828fb (LOCAL_ONLY) 20140626124239 macros/FullScan_50x.ijm
  51565b01 (LOCAL_ONLY) 20141209172107 macros/LoggerDataExtract.ijm
  3b8be573 (LOCAL_ONLY) 20140624092005 macros/MultiOpen.ijm
  c2c3c8fa (LOCAL_ONLY) 20141209172109 macros/ScannertoRGBij.ijm
  20c298a4 (LOCAL_ONLY) 20140604130515 macros/StackReg.ijm
  54bc1cc8 (LOCAL_ONLY) 20140731181111 macros/Timelapse overlay.ijm
  0e90592c (LOCAL_ONLY) 20140624161002 macros/Timelapse1.ijm
  0ea65c05 (LOCAL_ONLY) 20140804113436 macros/VirtualDubMacro.ijm
  05337381 (LOCAL_ONLY) 20140804144053 macros/WB Single.ijm
  76215538 (LOCAL_ONLY) 20140804144725 macros/WB Stack.ijm
  b0408dbd (LOCAL_ONLY) 20150126154553 macros/WhiteBalanceAreaMean.ijm
  83f01961 (LOCAL_ONLY) 20140729120800 plugins/Bleach Correction.ijm
  e532d82b (LOCAL_ONLY) 20140626175231 plugins/FullScan_100x.ijm
  553b12f8 (LOCAL_ONLY) 20140626175259 plugins/FullScan_200x.ijm
  842dac39 (LOCAL_ONLY) 20140626175242 plugins/FullScan_25x.ijm
  b90fcf8c (LOCAL_ONLY) 20140626175540 plugins/FullScan_500x.ijm
  fb0ea92b (LOCAL_ONLY) 20140626175247 plugins/FullScan_50x.ijm
  29aa129b (LOCAL_ONLY) 20140530113502 plugins/MeasureStack.class
  698e201e (LOCAL_ONLY) 20140530113502 plugins/MeasureStackReviewer.class
  db437772 (LOCAL_ONLY) 20140530113502 plugins/Measure_Stack.class
  2b893d8c (LOCAL_ONLY) 20140624133848 plugins/MultiOpen.ijm
  b7e36bf5 (LOCAL_ONLY) 20140804104151 plugins/RXTXcomm.jar
  b3b73e80 (LOCAL_ONLY) 20141210131339 plugins/Scan_.jar
  6aca4c14 (LOCAL_ONLY) 20140804151315 plugins/WB Single.ijm
  ff703cc6 (LOCAL_ONLY) 20140610111222 plugins/ij-dcraw_.jar
  27598922 (LOCAL_ONLY) 20140804103936 plugins/serial_ext.jar
  dcb0f1b8 (LOCAL_ONLY) 20141210131339 plugins/uk.co.mmscomputing.device.twain.jar</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">amc910
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-03-04 11:39:39 CST
        </span>
      </div>



<pre class="bz_comment_text" >As an update, I've just tried to restart FIJI and run the Align by line ROI plugin on the sample images, and it has worked ok.
After some poking it looks as though the exception comes about when there are more than two images open, that is more images open than those you wish to align.
The order the images are opened also seems to be an issue.
If I open boat.gif(1), bridge.gif(2) and Dot_Blot.jpg(3), I can align 1 and 2, but both 2 and 3 and 1 and 3 throw up another nullpointer exception.

Aligning 2 and 3 gives the same

at Align_Image.align(Align_Image.java:139)

error, but 1 and 3 gives

at Align_Image.align(Align_Image.java:141)

These errors also seem to stop if I bother to put a line ROI on the third image not being used, and just ignore it from then on.

So, this bug is now workable, but not ideal (especially if you don't know the fix)

Cheers,
Angus</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-03-24 22:24:22 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for the report!

This bug is now fixed:
<a href="https://github.com/fiji/VIB/commit/a24791f4383b2127e2a263f6327760b223f48965">https://github.com/fiji/VIB/commit/a24791f4383b2127e2a263f6327760b223f48965</a>

I released VIB 2.0.3 and uploaded it to the Fiji update site.

Enjoy.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">amc910
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-03-26 04:51:41 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Great, cheers Curtis!

Angus</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>


</div>

</body>
</html>
